<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3 Attribute data operations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="3. Attribute data operations_files/libs/clipboard/clipboard.min.js"></script>
<script src="3. Attribute data operations_files/libs/quarto-html/quarto.js"></script>
<script src="3. Attribute data operations_files/libs/quarto-html/popper.min.js"></script>
<script src="3. Attribute data operations_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="3. Attribute data operations_files/libs/quarto-html/anchor.min.js"></script>
<link href="3. Attribute data operations_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="3. Attribute data operations_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="3. Attribute data operations_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="3. Attribute data operations_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="3. Attribute data operations_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">3 Attribute data operations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="attribute-data-operations" class="level1">
<h1><strong>3 Attribute data operations</strong></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)      <span class="co"># vector data package introduced in Chapter 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.2, GDAL 3.7.2, PROJ 9.3.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)   <span class="co"># raster data package introduced in Chapter 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.73</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)   <span class="co"># tidyverse package for data frame manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:terra':

    intersect, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spData)  <span class="co"># spatial data package introduced in Chapter 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spData' was built under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)   <span class="co"># run data ‘tidying’ operations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:terra':

    extract</code></pre>
</div>
</div>
<p>Attribute data is non-spatial information associated with geographic (geometry) data.</p>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example:</h4>
<p>Geographic (geometry) data contains:</p>
<ol type="1">
<li><p>non-spatial information</p>
<ul>
<li>name of a location: Abuja City Gate</li>
</ul></li>
<li><p>spatial data (POINT (-0.098 51.495) in the sfc representation):</p>
<ul>
<li><p>Latitude: 51.495</p></li>
<li><p>Longitude: -0.098</p></li>
</ul></li>
</ol>
</section>
<section id="vector-attribute-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="vector-attribute-manipulation"><strong>3.2</strong> Vector attribute manipulation</h2>
<p>Geographic vector datasets are well supported in R. That is, sf objects:</p>
<ul>
<li><p>have one column per attribute variable (such as ‘name’) and one row per observation or&nbsp;<em>feature</em>&nbsp;(e.g., per bus station)</p></li>
<li><p>have a&nbsp;<code>geometry</code>&nbsp;column of class&nbsp;<code>sfc</code>&nbsp;which can contain a range of geographic entities (single and ‘multi’ point, line, and polygon features) per row</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class =</span> <span class="st">"sf"</span>) <span class="co"># methods for sf objects, first 12 shown</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] $&lt;-                          [                           
  [3] [[&lt;-                         aggregate                   
  [5] anti_join                    arrange                     
  [7] as.data.frame                cbind                       
  [9] coerce                       crs                         
 [11] dbDataType                   dbWriteTable                
 [13] distance                     distinct                    
 [15] dplyr_reconstruct            drop_na                     
 [17] duplicated                   ext                         
 [19] extract                      filter                      
 [21] full_join                    gather                      
 [23] group_by                     group_split                 
 [25] identify                     initialize                  
 [27] inner_join                   left_join                   
 [29] lines                        mask                        
 [31] merge                        mutate                      
 [33] nest                         pivot_longer                
 [35] pivot_wider                  plot                        
 [37] points                       polys                       
 [39] print                        rasterize                   
 [41] rbind                        rename                      
 [43] rename_with                  right_join                  
 [45] rowwise                      sample_frac                 
 [47] sample_n                     select                      
 [49] semi_join                    separate                    
 [51] separate_rows                show                        
 [53] slice                        slotsFromS3                 
 [55] spread                       st_agr                      
 [57] st_agr&lt;-                     st_area                     
 [59] st_as_s2                     st_as_sf                    
 [61] st_as_sfc                    st_bbox                     
 [63] st_boundary                  st_break_antimeridian       
 [65] st_buffer                    st_cast                     
 [67] st_centroid                  st_collection_extract       
 [69] st_concave_hull              st_convex_hull              
 [71] st_coordinates               st_crop                     
 [73] st_crs                       st_crs&lt;-                    
 [75] st_difference                st_drop_geometry            
 [77] st_filter                    st_geometry                 
 [79] st_geometry&lt;-                st_inscribed_circle         
 [81] st_interpolate_aw            st_intersection             
 [83] st_intersects                st_is                       
 [85] st_is_valid                  st_join                     
 [87] st_line_merge                st_m_range                  
 [89] st_make_valid                st_minimum_rotated_rectangle
 [91] st_nearest_points            st_node                     
 [93] st_normalize                 st_point_on_surface         
 [95] st_polygonize                st_precision                
 [97] st_reverse                   st_sample                   
 [99] st_segmentize                st_set_precision            
[101] st_shift_longitude           st_simplify                 
[103] st_snap                      st_sym_difference           
[105] st_transform                 st_triangulate              
[107] st_triangulate_constrained   st_union                    
[109] st_voronoi                   st_wrap_dateline            
[111] st_write                     st_z_range                  
[113] st_zm                        summarise                   
[115] svc                          transform                   
[117] transmute                    ungroup                     
[119] unite                        unnest                      
[121] vect                        
see '?methods' for accessing help and source code</code></pre>
</div>
</div>
<p>The geometry column of <code>sf</code> objects is typically called <code>geometry</code> or <code>geom</code> but any name can be used. The following command, for example, creates a geometry column named g:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>world</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 11
   iso_a2 name_long continent region_un subregion type  area_km2     pop lifeExp
 * &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 FJ     Fiji      Oceania   Oceania   Melanesia Sove…   1.93e4  8.86e5    70.0
 2 TZ     Tanzania  Africa    Africa    Eastern … Sove…   9.33e5  5.22e7    64.2
 3 EH     Western … Africa    Africa    Northern… Inde…   9.63e4 NA         NA  
 4 CA     Canada    North Am… Americas  Northern… Sove…   1.00e7  3.55e7    82.0
 5 US     United S… North Am… Americas  Northern… Coun…   9.51e6  3.19e8    78.8
 6 KZ     Kazakhst… Asia      Asia      Central … Sove…   2.73e6  1.73e7    71.6
 7 UZ     Uzbekist… Asia      Asia      Central … Sove…   4.61e5  3.08e7    71.0
 8 PG     Papua Ne… Oceania   Oceania   Melanesia Sove…   4.65e5  7.76e6    65.2
 9 ID     Indonesia Asia      Asia      South-Ea… Sove…   1.82e6  2.55e8    68.9
10 AR     Argentina South Am… Americas  South Am… Sove…   2.78e6  4.30e7    76.3
# ℹ 167 more rows
# ℹ 2 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_sf</span>(<span class="fu">data.frame</span>(<span class="at">n =</span> world<span class="sc">$</span>name_long), <span class="at">g =</span> world<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
First 10 features:
                  n                              g
1              Fiji MULTIPOLYGON (((-180 -16.55...
2          Tanzania MULTIPOLYGON (((33.90371 -0...
3    Western Sahara MULTIPOLYGON (((-8.66559 27...
4            Canada MULTIPOLYGON (((-132.71 54....
5     United States MULTIPOLYGON (((-171.7317 6...
6        Kazakhstan MULTIPOLYGON (((87.35997 49...
7        Uzbekistan MULTIPOLYGON (((55.96819 41...
8  Papua New Guinea MULTIPOLYGON (((141.0002 -2...
9         Indonesia MULTIPOLYGON (((104.37 -1.0...
10        Argentina MULTIPOLYGON (((-68.63401 -...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># breakdown nested function statement</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>?st_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>starting httpd help server ... done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>world<span class="sc">$</span>name_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "Fiji"                               
  [2] "Tanzania"                           
  [3] "Western Sahara"                     
  [4] "Canada"                             
  [5] "United States"                      
  [6] "Kazakhstan"                         
  [7] "Uzbekistan"                         
  [8] "Papua New Guinea"                   
  [9] "Indonesia"                          
 [10] "Argentina"                          
 [11] "Chile"                              
 [12] "Democratic Republic of the Congo"   
 [13] "Somalia"                            
 [14] "Kenya"                              
 [15] "Sudan"                              
 [16] "Chad"                               
 [17] "Haiti"                              
 [18] "Dominican Republic"                 
 [19] "Russian Federation"                 
 [20] "Bahamas"                            
 [21] "Falkland Islands"                   
 [22] "Norway"                             
 [23] "Greenland"                          
 [24] "French Southern and Antarctic Lands"
 [25] "Timor-Leste"                        
 [26] "South Africa"                       
 [27] "Lesotho"                            
 [28] "Mexico"                             
 [29] "Uruguay"                            
 [30] "Brazil"                             
 [31] "Bolivia"                            
 [32] "Peru"                               
 [33] "Colombia"                           
 [34] "Panama"                             
 [35] "Costa Rica"                         
 [36] "Nicaragua"                          
 [37] "Honduras"                           
 [38] "El Salvador"                        
 [39] "Guatemala"                          
 [40] "Belize"                             
 [41] "Venezuela"                          
 [42] "Guyana"                             
 [43] "Suriname"                           
 [44] "France"                             
 [45] "Ecuador"                            
 [46] "Puerto Rico"                        
 [47] "Jamaica"                            
 [48] "Cuba"                               
 [49] "Zimbabwe"                           
 [50] "Botswana"                           
 [51] "Namibia"                            
 [52] "Senegal"                            
 [53] "Mali"                               
 [54] "Mauritania"                         
 [55] "Benin"                              
 [56] "Niger"                              
 [57] "Nigeria"                            
 [58] "Cameroon"                           
 [59] "Togo"                               
 [60] "Ghana"                              
 [61] "Côte d'Ivoire"                      
 [62] "Guinea"                             
 [63] "Guinea-Bissau"                      
 [64] "Liberia"                            
 [65] "Sierra Leone"                       
 [66] "Burkina Faso"                       
 [67] "Central African Republic"           
 [68] "Republic of the Congo"              
 [69] "Gabon"                              
 [70] "Equatorial Guinea"                  
 [71] "Zambia"                             
 [72] "Malawi"                             
 [73] "Mozambique"                         
 [74] "eSwatini"                           
 [75] "Angola"                             
 [76] "Burundi"                            
 [77] "Israel"                             
 [78] "Lebanon"                            
 [79] "Madagascar"                         
 [80] "Palestine"                          
 [81] "The Gambia"                         
 [82] "Tunisia"                            
 [83] "Algeria"                            
 [84] "Jordan"                             
 [85] "United Arab Emirates"               
 [86] "Qatar"                              
 [87] "Kuwait"                             
 [88] "Iraq"                               
 [89] "Oman"                               
 [90] "Vanuatu"                            
 [91] "Cambodia"                           
 [92] "Thailand"                           
 [93] "Lao PDR"                            
 [94] "Myanmar"                            
 [95] "Vietnam"                            
 [96] "Dem. Rep. Korea"                    
 [97] "Republic of Korea"                  
 [98] "Mongolia"                           
 [99] "India"                              
[100] "Bangladesh"                         
[101] "Bhutan"                             
[102] "Nepal"                              
[103] "Pakistan"                           
[104] "Afghanistan"                        
[105] "Tajikistan"                         
[106] "Kyrgyzstan"                         
[107] "Turkmenistan"                       
[108] "Iran"                               
[109] "Syria"                              
[110] "Armenia"                            
[111] "Sweden"                             
[112] "Belarus"                            
[113] "Ukraine"                            
[114] "Poland"                             
[115] "Austria"                            
[116] "Hungary"                            
[117] "Moldova"                            
[118] "Romania"                            
[119] "Lithuania"                          
[120] "Latvia"                             
[121] "Estonia"                            
[122] "Germany"                            
[123] "Bulgaria"                           
[124] "Greece"                             
[125] "Turkey"                             
[126] "Albania"                            
[127] "Croatia"                            
[128] "Switzerland"                        
[129] "Luxembourg"                         
[130] "Belgium"                            
[131] "Netherlands"                        
[132] "Portugal"                           
[133] "Spain"                              
[134] "Ireland"                            
[135] "New Caledonia"                      
[136] "Solomon Islands"                    
[137] "New Zealand"                        
[138] "Australia"                          
[139] "Sri Lanka"                          
[140] "China"                              
[141] "Taiwan"                             
[142] "Italy"                              
[143] "Denmark"                            
[144] "United Kingdom"                     
[145] "Iceland"                            
[146] "Azerbaijan"                         
[147] "Georgia"                            
[148] "Philippines"                        
[149] "Malaysia"                           
[150] "Brunei Darussalam"                  
[151] "Slovenia"                           
[152] "Finland"                            
[153] "Slovakia"                           
[154] "Czech Republic"                     
[155] "Eritrea"                            
[156] "Japan"                              
[157] "Paraguay"                           
[158] "Yemen"                              
[159] "Saudi Arabia"                       
[160] "Antarctica"                         
[161] "Northern Cyprus"                    
[162] "Cyprus"                             
[163] "Morocco"                            
[164] "Egypt"                              
[165] "Libya"                              
[166] "Ethiopia"                           
[167] "Djibouti"                           
[168] "Somaliland"                         
[169] "Uganda"                             
[170] "Rwanda"                             
[171] "Bosnia and Herzegovina"             
[172] "Macedonia"                          
[173] "Serbia"                             
[174] "Montenegro"                         
[175] "Kosovo"                             
[176] "Trinidad and Tobago"                
[177] "South Sudan"                        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>world<span class="sc">$</span>geom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 177 features 
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
First 5 geometries:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>MULTIPOLYGON (((-180 -16.55522, -179.9174 -16.5...
MULTIPOLYGON (((33.90371 -0.95, 31.86617 -1.027...
MULTIPOLYGON (((-8.66559 27.65643, -8.817828 27...
MULTIPOLYGON (((-132.71 54.04001, -133.18 54.16...
MULTIPOLYGON (((-171.7317 63.78252, -171.7911 6...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">n =</span> world<span class="sc">$</span>name_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      n
1                                  Fiji
2                              Tanzania
3                        Western Sahara
4                                Canada
5                         United States
6                            Kazakhstan
7                            Uzbekistan
8                      Papua New Guinea
9                             Indonesia
10                            Argentina
11                                Chile
12     Democratic Republic of the Congo
13                              Somalia
14                                Kenya
15                                Sudan
16                                 Chad
17                                Haiti
18                   Dominican Republic
19                   Russian Federation
20                              Bahamas
21                     Falkland Islands
22                               Norway
23                            Greenland
24  French Southern and Antarctic Lands
25                          Timor-Leste
26                         South Africa
27                              Lesotho
28                               Mexico
29                              Uruguay
30                               Brazil
31                              Bolivia
32                                 Peru
33                             Colombia
34                               Panama
35                           Costa Rica
36                            Nicaragua
37                             Honduras
38                          El Salvador
39                            Guatemala
40                               Belize
41                            Venezuela
42                               Guyana
43                             Suriname
44                               France
45                              Ecuador
46                          Puerto Rico
47                              Jamaica
48                                 Cuba
49                             Zimbabwe
50                             Botswana
51                              Namibia
52                              Senegal
53                                 Mali
54                           Mauritania
55                                Benin
56                                Niger
57                              Nigeria
58                             Cameroon
59                                 Togo
60                                Ghana
61                        Côte d'Ivoire
62                               Guinea
63                        Guinea-Bissau
64                              Liberia
65                         Sierra Leone
66                         Burkina Faso
67             Central African Republic
68                Republic of the Congo
69                                Gabon
70                    Equatorial Guinea
71                               Zambia
72                               Malawi
73                           Mozambique
74                             eSwatini
75                               Angola
76                              Burundi
77                               Israel
78                              Lebanon
79                           Madagascar
80                            Palestine
81                           The Gambia
82                              Tunisia
83                              Algeria
84                               Jordan
85                 United Arab Emirates
86                                Qatar
87                               Kuwait
88                                 Iraq
89                                 Oman
90                              Vanuatu
91                             Cambodia
92                             Thailand
93                              Lao PDR
94                              Myanmar
95                              Vietnam
96                      Dem. Rep. Korea
97                    Republic of Korea
98                             Mongolia
99                                India
100                          Bangladesh
101                              Bhutan
102                               Nepal
103                            Pakistan
104                         Afghanistan
105                          Tajikistan
106                          Kyrgyzstan
107                        Turkmenistan
108                                Iran
109                               Syria
110                             Armenia
111                              Sweden
112                             Belarus
113                             Ukraine
114                              Poland
115                             Austria
116                             Hungary
117                             Moldova
118                             Romania
119                           Lithuania
120                              Latvia
121                             Estonia
122                             Germany
123                            Bulgaria
124                              Greece
125                              Turkey
126                             Albania
127                             Croatia
128                         Switzerland
129                          Luxembourg
130                             Belgium
131                         Netherlands
132                            Portugal
133                               Spain
134                             Ireland
135                       New Caledonia
136                     Solomon Islands
137                         New Zealand
138                           Australia
139                           Sri Lanka
140                               China
141                              Taiwan
142                               Italy
143                             Denmark
144                      United Kingdom
145                             Iceland
146                          Azerbaijan
147                             Georgia
148                         Philippines
149                            Malaysia
150                   Brunei Darussalam
151                            Slovenia
152                             Finland
153                            Slovakia
154                      Czech Republic
155                             Eritrea
156                               Japan
157                            Paraguay
158                               Yemen
159                        Saudi Arabia
160                          Antarctica
161                     Northern Cyprus
162                              Cyprus
163                             Morocco
164                               Egypt
165                               Libya
166                            Ethiopia
167                            Djibouti
168                          Somaliland
169                              Uganda
170                              Rwanda
171              Bosnia and Herzegovina
172                           Macedonia
173                              Serbia
174                          Montenegro
175                              Kosovo
176                 Trinidad and Tobago
177                         South Sudan</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> world<span class="sc">$</span>geom</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 177 features 
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
First 5 geometries:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>MULTIPOLYGON (((-180 -16.55522, -179.9174 -16.5...
MULTIPOLYGON (((33.90371 -0.95, 31.86617 -1.027...
MULTIPOLYGON (((-8.66559 27.65643, -8.817828 27...
MULTIPOLYGON (((-132.71 54.04001, -133.18 54.16...
MULTIPOLYGON (((-171.7317 63.78252, -171.7911 6...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_sf</span>(<span class="fu">data.frame</span>(<span class="at">n =</span> world<span class="sc">$</span>name_long), <span class="at">g =</span> world<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
First 10 features:
                  n                              g
1              Fiji MULTIPOLYGON (((-180 -16.55...
2          Tanzania MULTIPOLYGON (((33.90371 -0...
3    Western Sahara MULTIPOLYGON (((-8.66559 27...
4            Canada MULTIPOLYGON (((-132.71 54....
5     United States MULTIPOLYGON (((-171.7317 6...
6        Kazakhstan MULTIPOLYGON (((87.35997 49...
7        Uzbekistan MULTIPOLYGON (((55.96819 41...
8  Papua New Guinea MULTIPOLYGON (((141.0002 -2...
9         Indonesia MULTIPOLYGON (((104.37 -1.0...
10        Argentina MULTIPOLYGON (((-68.63401 -...</code></pre>
</div>
</div>
<ul>
<li>can also extend the tidyverse classes for data frames,&nbsp;<code>tbl_df</code>&nbsp;and&nbsp;<code>tbl (i.e.</code><strong>sf</strong>&nbsp;enables the full power of R’s data analysis capabilities<code>)</code></li>
</ul>
<section id="exploring-the-world-dataset-from-spdata-package" class="level3">
<h3 class="anchored" data-anchor-id="exploring-the-world-dataset-from-spdata-package">Exploring the world dataset from spData package</h3>
<p><code>world</code>&nbsp;contains ten non-geographic columns (and one geometry list column) with almost 200 rows representing the world’s countries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(world) <span class="co"># it's an sf object and a (tidy) data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(world)   <span class="co"># it is a 2 dimensional object, with 177 rows and 11 columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 177  11</code></pre>
</div>
</div>
<p>The function&nbsp;<a href="https://r-spatial.github.io/sf/reference/st_geometry.html"><code>st_drop_geometry()</code></a>&nbsp;keeps only the attributes data of an&nbsp;<code>sf</code>&nbsp;object, in other words removing its geometry:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>world_df <span class="ot">=</span> <span class="fu">st_drop_geometry</span>(world)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(world_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(world_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
</section>
<section id="vector-attribute-subsetting" class="level3">
<h3 class="anchored" data-anchor-id="vector-attribute-subsetting"><strong>3.2.1 Vector attribute subsetting</strong></h3>
<p>This is similar to a refresher for subsetting data frame using the base R function and the dplyr package. <strong>The ONLY thing you have to remember is the sticky situation i.e.&nbsp;the geom column always comes with the dataset.</strong></p>
<p><strong>Example 1:</strong></p>
<p>The examples below demonstrate subsetting with base R. Base R functions are mature, stable and widely used, making them a rock solid choice, especially in contexts where reproducibility and reliability are key.&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>world[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]    <span class="co"># subset rows by position</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -18.28799 xmax: 180 ymax: 83.23324
Geodetic CRS:  WGS 84
# A tibble: 6 × 11
  iso_a2 name_long  continent region_un subregion type  area_km2     pop lifeExp
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 FJ     Fiji       Oceania   Oceania   Melanesia Sove…   1.93e4  8.86e5    70.0
2 TZ     Tanzania   Africa    Africa    Eastern … Sove…   9.33e5  5.22e7    64.2
3 EH     Western S… Africa    Africa    Northern… Inde…   9.63e4 NA         NA  
4 CA     Canada     North Am… Americas  Northern… Sove…   1.00e7  3.55e7    82.0
5 US     United St… North Am… Americas  Northern… Coun…   9.51e6  3.19e8    78.8
6 KZ     Kazakhstan Asia      Asia      Central … Sove…   2.73e6  1.73e7    71.6
# ℹ 2 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>world[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]    <span class="co"># subset columns by position</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 4
   iso_a2 name_long        continent                                        geom
   &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;                              &lt;MULTIPOLYGON [°]&gt;
 1 FJ     Fiji             Oceania       (((-180 -16.55522, -179.9174 -16.50178…
 2 TZ     Tanzania         Africa        (((33.90371 -0.95, 31.86617 -1.02736, …
 3 EH     Western Sahara   Africa        (((-8.66559 27.65643, -8.817828 27.656…
 4 CA     Canada           North America (((-132.71 54.04001, -133.18 54.16998,…
 5 US     United States    North America (((-171.7317 63.78252, -171.7911 63.40…
 6 KZ     Kazakhstan       Asia          (((87.35997 49.21498, 86.82936 49.8266…
 7 UZ     Uzbekistan       Asia          (((55.96819 41.30864, 57.09639 41.3223…
 8 PG     Papua New Guinea Oceania       (((141.0002 -2.600151, 141.0171 -5.859…
 9 ID     Indonesia        Asia          (((104.37 -1.084843, 104.0108 -1.05921…
10 AR     Argentina        South America (((-68.63401 -52.63637, -68.63335 -54.…
# ℹ 167 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>world[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="co"># subset rows and columns by position</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -18.28799 xmax: 180 ymax: 83.23324
Geodetic CRS:  WGS 84
# A tibble: 6 × 4
  iso_a2 name_long      continent                                           geom
  &lt;chr&gt;  &lt;chr&gt;          &lt;chr&gt;                                 &lt;MULTIPOLYGON [°]&gt;
1 FJ     Fiji           Oceania       (((-180 -16.55522, -179.9174 -16.50178, -…
2 TZ     Tanzania       Africa        (((33.90371 -0.95, 31.86617 -1.02736, 30.…
3 EH     Western Sahara Africa        (((-8.66559 27.65643, -8.817828 27.65643,…
4 CA     Canada         North America (((-132.71 54.04001, -133.18 54.16998, -1…
5 US     United States  North America (((-171.7317 63.78252, -171.7911 63.40585…
6 KZ     Kazakhstan     Asia          (((87.35997 49.21498, 86.82936 49.82667, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>world[, <span class="fu">c</span>(<span class="st">"name_long"</span>, <span class="st">"pop"</span>)] <span class="co"># columns by name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 3
   name_long              pop                                               geom
   &lt;chr&gt;                &lt;dbl&gt;                                 &lt;MULTIPOLYGON [°]&gt;
 1 Fiji                885806 (((-180 -16.55522, -179.9174 -16.50178, -179.7933…
 2 Tanzania          52234869 (((33.90371 -0.95, 31.86617 -1.02736, 30.76986 -1…
 3 Western Sahara          NA (((-8.66559 27.65643, -8.817828 27.65643, -8.7948…
 4 Canada            35535348 (((-132.71 54.04001, -133.18 54.16998, -133.2397 …
 5 United States    318622525 (((-171.7317 63.78252, -171.7911 63.40585, -171.5…
 6 Kazakhstan        17288285 (((87.35997 49.21498, 86.82936 49.82667, 85.54127…
 7 Uzbekistan        30757700 (((55.96819 41.30864, 57.09639 41.32231, 56.93222…
 8 Papua New Guinea   7755785 (((141.0002 -2.600151, 141.0171 -5.859022, 141.03…
 9 Indonesia        255131116 (((104.37 -1.084843, 104.0108 -1.059212, 103.4376…
10 Argentina         42981515 (((-68.63401 -52.63637, -68.63335 -54.8695, -67.5…
# ℹ 167 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>world[, <span class="fu">c</span>(T, T, F, F, F, F, F, T, T, F, F)] <span class="co"># by logical indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 5
   iso_a2 name_long              pop lifeExp                                geom
   &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt;                  &lt;MULTIPOLYGON [°]&gt;
 1 FJ     Fiji                885806    70.0 (((-180 -16.55522, -179.9174 -16.5…
 2 TZ     Tanzania          52234869    64.2 (((33.90371 -0.95, 31.86617 -1.027…
 3 EH     Western Sahara          NA    NA   (((-8.66559 27.65643, -8.817828 27…
 4 CA     Canada            35535348    82.0 (((-132.71 54.04001, -133.18 54.16…
 5 US     United States    318622525    78.8 (((-171.7317 63.78252, -171.7911 6…
 6 KZ     Kazakhstan        17288285    71.6 (((87.35997 49.21498, 86.82936 49.…
 7 UZ     Uzbekistan        30757700    71.0 (((55.96819 41.30864, 57.09639 41.…
 8 PG     Papua New Guinea   7755785    65.2 (((141.0002 -2.600151, 141.0171 -5…
 9 ID     Indonesia        255131116    68.9 (((104.37 -1.084843, 104.0108 -1.0…
10 AR     Argentina         42981515    76.3 (((-68.63401 -52.63637, -68.63335 …
# ℹ 167 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#world[, 888] # an index representing a non-existent column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A demonstration of the utility of using <code>logical</code> vectors for subsetting is shown in the code chunk below. This creates a new object, <code>small_countries</code>, containing nations whose surface area is smaller than 10,000 km<sup>2</sup>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>i_small <span class="ot">=</span> world<span class="sc">$</span>area_km2 <span class="sc">&lt;</span> <span class="dv">10000</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(i_small) <span class="co"># a logical vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Mode   FALSE    TRUE 
logical     170       7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>small_countries <span class="ot">=</span> world[i_small, ]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>small_countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -67.24243 ymin: -16.59785 xmax: 167.8449 ymax: 50.12805
Geodetic CRS:  WGS 84
# A tibble: 7 × 11
  iso_a2 name_long  continent region_un subregion type  area_km2     pop lifeExp
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 PR     Puerto Ri… North Am… Americas  Caribbean Depe…    9225. 3534874    79.4
2 PS     Palestine  Asia      Asia      Western … Disp…    5037. 4294682    73.1
3 VU     Vanuatu    Oceania   Oceania   Melanesia Sove…    7490.  258850    71.7
4 LU     Luxembourg Europe    Europe    Western … Sove…    2417.  556319    82.2
5 &lt;NA&gt;   Northern … Asia      Asia      Western … Sove…    3786.      NA    NA  
6 CY     Cyprus     Asia      Asia      Western … Sove…    6207. 1152309    80.2
7 TT     Trinidad … North Am… Americas  Caribbean Sove…    7738. 1354493    70.4
# ℹ 2 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
</div>
<p>A more concise command, which omits the intermediary object, generates the same result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>small_countries <span class="ot">=</span> world[world<span class="sc">$</span>area_km2 <span class="sc">&lt;</span> <span class="dv">10000</span>, ]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>small_countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -67.24243 ymin: -16.59785 xmax: 167.8449 ymax: 50.12805
Geodetic CRS:  WGS 84
# A tibble: 7 × 11
  iso_a2 name_long  continent region_un subregion type  area_km2     pop lifeExp
  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 PR     Puerto Ri… North Am… Americas  Caribbean Depe…    9225. 3534874    79.4
2 PS     Palestine  Asia      Asia      Western … Disp…    5037. 4294682    73.1
3 VU     Vanuatu    Oceania   Oceania   Melanesia Sove…    7490.  258850    71.7
4 LU     Luxembourg Europe    Europe    Western … Sove…    2417.  556319    82.2
5 &lt;NA&gt;   Northern … Asia      Asia      Western … Sove…    3786.      NA    NA  
6 CY     Cyprus     Asia      Asia      Western … Sove…    6207. 1152309    80.2
7 TT     Trinidad … North Am… Americas  Caribbean Sove…    7738. 1354493    70.4
# ℹ 2 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
</div>
<p><strong>Example 2:</strong></p>
<p><strong>dplyr</strong>&nbsp;functions enable ‘tidy’ workflows which are found intuitive and productive for interactive data analysis.</p>
<p><a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a>&nbsp;selects columns by name or position. For example, you could select only two columns,&nbsp;<code>name_long</code>&nbsp;and&nbsp;<code>pop</code>, with the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>world1 <span class="ot">=</span> <span class="fu">select</span>(world, name_long, pop)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(world1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "name_long" "pop"       "geom"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>world1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 3
   name_long              pop                                               geom
   &lt;chr&gt;                &lt;dbl&gt;                                 &lt;MULTIPOLYGON [°]&gt;
 1 Fiji                885806 (((-180 -16.55522, -179.9174 -16.50178, -179.7933…
 2 Tanzania          52234869 (((33.90371 -0.95, 31.86617 -1.02736, 30.76986 -1…
 3 Western Sahara          NA (((-8.66559 27.65643, -8.817828 27.65643, -8.7948…
 4 Canada            35535348 (((-132.71 54.04001, -133.18 54.16998, -133.2397 …
 5 United States    318622525 (((-171.7317 63.78252, -171.7911 63.40585, -171.5…
 6 Kazakhstan        17288285 (((87.35997 49.21498, 86.82936 49.82667, 85.54127…
 7 Uzbekistan        30757700 (((55.96819 41.30864, 57.09639 41.32231, 56.93222…
 8 Papua New Guinea   7755785 (((141.0002 -2.600151, 141.0171 -5.859022, 141.03…
 9 Indonesia        255131116 (((104.37 -1.084843, 104.0108 -1.059212, 103.4376…
10 Argentina         42981515 (((-68.63401 -52.63637, -68.63335 -54.8695, -67.5…
# ℹ 167 more rows</code></pre>
</div>
</div>
<p>Note: as with the equivalent command in base R (<code>world[, c("name_long", "pop")]</code>), the sticky&nbsp;<code>geom</code>&nbsp;column remains.&nbsp;<a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a>&nbsp;also allows selecting a range of columns with the help of the&nbsp;<code>:</code>&nbsp;operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all columns between name_long and pop (inclusive)</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>world2 <span class="ot">=</span> <span class="fu">select</span>(world, name_long<span class="sc">:</span>pop)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(world2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "name_long" "continent" "region_un" "subregion" "type"      "area_km2" 
[7] "pop"       "geom"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>world2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 7 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 8
   name_long        continent     region_un subregion     type  area_km2     pop
   &lt;chr&gt;            &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1 Fiji             Oceania       Oceania   Melanesia     Sove…   1.93e4  8.86e5
 2 Tanzania         Africa        Africa    Eastern Afri… Sove…   9.33e5  5.22e7
 3 Western Sahara   Africa        Africa    Northern Afr… Inde…   9.63e4 NA     
 4 Canada           North America Americas  Northern Ame… Sove…   1.00e7  3.55e7
 5 United States    North America Americas  Northern Ame… Coun…   9.51e6  3.19e8
 6 Kazakhstan       Asia          Asia      Central Asia  Sove…   2.73e6  1.73e7
 7 Uzbekistan       Asia          Asia      Central Asia  Sove…   4.61e5  3.08e7
 8 Papua New Guinea Oceania       Oceania   Melanesia     Sove…   4.65e5  7.76e6
 9 Indonesia        Asia          Asia      South-Easter… Sove…   1.82e6  2.55e8
10 Argentina        South America Americas  South America Sove…   2.78e6  4.30e7
# ℹ 167 more rows
# ℹ 1 more variable: geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
</div>
<p>remove specific columns with the&nbsp;<code>-</code>&nbsp;operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all columns except subregion and area_km2 (inclusive)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>world3 <span class="ot">=</span> <span class="fu">select</span>(world, <span class="sc">-</span>subregion, <span class="sc">-</span>area_km2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Subset and rename columns at the same time with the&nbsp;<code>new_name = old_name</code>&nbsp;syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>world4 <span class="ot">=</span> <span class="fu">select</span>(world, name_long, <span class="at">population =</span> pop)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>world4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 3
   name_long        population                                              geom
   &lt;chr&gt;                 &lt;dbl&gt;                                &lt;MULTIPOLYGON [°]&gt;
 1 Fiji                 885806 (((-180 -16.55522, -179.9174 -16.50178, -179.793…
 2 Tanzania           52234869 (((33.90371 -0.95, 31.86617 -1.02736, 30.76986 -…
 3 Western Sahara           NA (((-8.66559 27.65643, -8.817828 27.65643, -8.794…
 4 Canada             35535348 (((-132.71 54.04001, -133.18 54.16998, -133.2397…
 5 United States     318622525 (((-171.7317 63.78252, -171.7911 63.40585, -171.…
 6 Kazakhstan         17288285 (((87.35997 49.21498, 86.82936 49.82667, 85.5412…
 7 Uzbekistan         30757700 (((55.96819 41.30864, 57.09639 41.32231, 56.9322…
 8 Papua New Guinea    7755785 (((141.0002 -2.600151, 141.0171 -5.859022, 141.0…
 9 Indonesia         255131116 (((104.37 -1.084843, 104.0108 -1.059212, 103.437…
10 Argentina          42981515 (((-68.63401 -52.63637, -68.63335 -54.8695, -67.…
# ℹ 167 more rows</code></pre>
</div>
</div>
<p>Most&nbsp;<strong>dplyr</strong>&nbsp;verbs return a data frame, but you can extract a single column as a vector with&nbsp;<a href="https://dplyr.tidyverse.org/reference/pull.html"><code>pull()</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pull</span>(world, pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]     885806   52234869         NA   35535348  318622525   17288285
  [7]   30757700    7755785  255131116   42981515   17613798   73722860
 [13]   13513125   46024250   37737913   13569438   10572466   10405844
 [19]  143819666     382169         NA         NA      56295         NA
 [25]    1212814   54539571    2145785  124221600    3419546  204213133
 [31]   10562159   30973354   47791911    3903986    4757575    6013997
 [37]    8809216    6281189   15923559     351694   30738378     763393
 [43]     547928         NA   15903112    3534874    2862087   11439767
 [49]   15411675    2168573    2370992   14546111   16962846    4063920
 [55]   10286712   19148219  176460502   22239904    7228915   26962563
 [61]   22531350   11805509    1725744    4390737    7079162   17585977
 [67]    4515392    4871101    1875713    1129424   15620974   17068838
 [73]   27212382    1295097   26920466    9891790    8215700    5603279
 [79]   23589801    4294682    1917852   11143908   39113313    8809306
 [85]    9070867    2374419    3782450   35006080    3960925     258850
 [91]   15270790   68416772    6576397   51924182   92544915   25116363
 [97]   50746659    2923896 1293859294  159405279     776448   28323241
[103]  185546257   32758020    8362745    5835500    5466241   78411092
[109]   19203090    2906220    9696110    9474511   45271947   38011735
[115]    8546356    9866468    3556397   19908979    2932367    1993782
[121]    1314545   80982500    7223938   10892413   77030628    2889104
[127]    4238389    8188649     556319   11209057   16865008   10401062
[133]   46480882    4657740     268050     575504    4509700   23504138
[139]   20771000 1364270000         NA   60789140    5643475   64613160
[145]     327386    9535079    3727000  100102249   30228017     411704
[151]    2061980    5461512    5418649   10525347         NA  127276000
[157]    6552584   26246327   30776722         NA         NA    1152309
[163]   34318082   91812566    6204108   97366774     912164         NA
[169]   38833338   11345357    3566002    2077495    7130576     621810
[175]    1821800    1354493   11530971</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>world<span class="sc">$</span>pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]     885806   52234869         NA   35535348  318622525   17288285
  [7]   30757700    7755785  255131116   42981515   17613798   73722860
 [13]   13513125   46024250   37737913   13569438   10572466   10405844
 [19]  143819666     382169         NA         NA      56295         NA
 [25]    1212814   54539571    2145785  124221600    3419546  204213133
 [31]   10562159   30973354   47791911    3903986    4757575    6013997
 [37]    8809216    6281189   15923559     351694   30738378     763393
 [43]     547928         NA   15903112    3534874    2862087   11439767
 [49]   15411675    2168573    2370992   14546111   16962846    4063920
 [55]   10286712   19148219  176460502   22239904    7228915   26962563
 [61]   22531350   11805509    1725744    4390737    7079162   17585977
 [67]    4515392    4871101    1875713    1129424   15620974   17068838
 [73]   27212382    1295097   26920466    9891790    8215700    5603279
 [79]   23589801    4294682    1917852   11143908   39113313    8809306
 [85]    9070867    2374419    3782450   35006080    3960925     258850
 [91]   15270790   68416772    6576397   51924182   92544915   25116363
 [97]   50746659    2923896 1293859294  159405279     776448   28323241
[103]  185546257   32758020    8362745    5835500    5466241   78411092
[109]   19203090    2906220    9696110    9474511   45271947   38011735
[115]    8546356    9866468    3556397   19908979    2932367    1993782
[121]    1314545   80982500    7223938   10892413   77030628    2889104
[127]    4238389    8188649     556319   11209057   16865008   10401062
[133]   46480882    4657740     268050     575504    4509700   23504138
[139]   20771000 1364270000         NA   60789140    5643475   64613160
[145]     327386    9535079    3727000  100102249   30228017     411704
[151]    2061980    5461512    5418649   10525347         NA  127276000
[157]    6552584   26246327   30776722         NA         NA    1152309
[163]   34318082   91812566    6204108   97366774     912164         NA
[169]   38833338   11345357    3566002    2077495    7130576     621810
[175]    1821800    1354493   11530971</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>world[[<span class="st">"pop"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]     885806   52234869         NA   35535348  318622525   17288285
  [7]   30757700    7755785  255131116   42981515   17613798   73722860
 [13]   13513125   46024250   37737913   13569438   10572466   10405844
 [19]  143819666     382169         NA         NA      56295         NA
 [25]    1212814   54539571    2145785  124221600    3419546  204213133
 [31]   10562159   30973354   47791911    3903986    4757575    6013997
 [37]    8809216    6281189   15923559     351694   30738378     763393
 [43]     547928         NA   15903112    3534874    2862087   11439767
 [49]   15411675    2168573    2370992   14546111   16962846    4063920
 [55]   10286712   19148219  176460502   22239904    7228915   26962563
 [61]   22531350   11805509    1725744    4390737    7079162   17585977
 [67]    4515392    4871101    1875713    1129424   15620974   17068838
 [73]   27212382    1295097   26920466    9891790    8215700    5603279
 [79]   23589801    4294682    1917852   11143908   39113313    8809306
 [85]    9070867    2374419    3782450   35006080    3960925     258850
 [91]   15270790   68416772    6576397   51924182   92544915   25116363
 [97]   50746659    2923896 1293859294  159405279     776448   28323241
[103]  185546257   32758020    8362745    5835500    5466241   78411092
[109]   19203090    2906220    9696110    9474511   45271947   38011735
[115]    8546356    9866468    3556397   19908979    2932367    1993782
[121]    1314545   80982500    7223938   10892413   77030628    2889104
[127]    4238389    8188649     556319   11209057   16865008   10401062
[133]   46480882    4657740     268050     575504    4509700   23504138
[139]   20771000 1364270000         NA   60789140    5643475   64613160
[145]     327386    9535079    3727000  100102249   30228017     411704
[151]    2061980    5461512    5418649   10525347         NA  127276000
[157]    6552584   26246327   30776722         NA         NA    1152309
[163]   34318082   91812566    6204108   97366774     912164         NA
[169]   38833338   11345357    3566002    2077495    7130576     621810
[175]    1821800    1354493   11530971</code></pre>
</div>
</div>
<p><a href="https://dplyr.tidyverse.org/reference/slice.html"><code>slice()</code></a>&nbsp;is the row-equivalent of&nbsp;<a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a>. The following code chunk, for example, selects rows 1 to 6:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(world, <span class="dv">10</span><span class="sc">:</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -75.6444 ymin: -55.61183 xmax: 51.13387 ymax: 23.40972
Geodetic CRS:  WGS 84
# A tibble: 7 × 11
  iso_a2 name_long   continent region_un subregion type  area_km2    pop lifeExp
  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 AR     Argentina   South Am… Americas  South Am… Sove… 2784469. 4.30e7    76.3
2 CL     Chile       South Am… Americas  South Am… Sove…  814844. 1.76e7    79.1
3 CD     Democratic… Africa    Africa    Middle A… Sove… 2323492. 7.37e7    58.8
4 SO     Somalia     Africa    Africa    Eastern … Sove…  484333. 1.35e7    55.5
5 KE     Kenya       Africa    Africa    Eastern … Sove…  590837. 4.60e7    66.2
6 SD     Sudan       Africa    Africa    Northern… Sove… 1850886. 3.77e7    64.0
7 TD     Chad        Africa    Africa    Middle A… Sove… 1271695. 1.36e7    52.2
# ℹ 2 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
</div>
<p><a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a>&nbsp;is&nbsp;<strong>dplyr</strong>’s equivalent of base R’s&nbsp;<a href="https://rspatial.github.io/terra/reference/subset.html"><code>subset()</code></a>&nbsp;function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>world7 <span class="ot">=</span> <span class="fu">filter</span>(world, area_km2 <span class="sc">&lt;</span> <span class="dv">10000</span>)  <span class="co"># countries with a small area</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>world7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -67.24243 ymin: -16.59785 xmax: 167.8449 ymax: 50.12805
Geodetic CRS:  WGS 84
# A tibble: 7 × 11
  iso_a2 name_long  continent region_un subregion type  area_km2     pop lifeExp
* &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 PR     Puerto Ri… North Am… Americas  Caribbean Depe…    9225. 3534874    79.4
2 PS     Palestine  Asia      Asia      Western … Disp…    5037. 4294682    73.1
3 VU     Vanuatu    Oceania   Oceania   Melanesia Sove…    7490.  258850    71.7
4 LU     Luxembourg Europe    Europe    Western … Sove…    2417.  556319    82.2
5 &lt;NA&gt;   Northern … Asia      Asia      Western … Sove…    3786.      NA    NA  
6 CY     Cyprus     Asia      Asia      Western … Sove…    6207. 1152309    80.2
7 TT     Trinidad … North Am… Americas  Caribbean Sove…    7738. 1354493    70.4
# ℹ 2 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>world7 <span class="ot">=</span> <span class="fu">filter</span>(world, lifeExp <span class="sc">&gt;</span> <span class="dv">82</span>)      <span class="co"># with high life expectancy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="chaining-commands-with-pipes" class="level3">
<h3 class="anchored" data-anchor-id="chaining-commands-with-pipes"><strong>3.2.2 Chaining commands with pipes</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>world7 <span class="ot">=</span> world <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Asia"</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name_long, continent) <span class="sc">|&gt;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>world7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 34.26543 ymin: -10.35999 xmax: 141.0339 ymax: 55.38525
Geodetic CRS:  WGS 84
# A tibble: 5 × 3
  name_long   continent                                                     geom
  &lt;chr&gt;       &lt;chr&gt;                                           &lt;MULTIPOLYGON [°]&gt;
1 Kazakhstan  Asia      (((87.35997 49.21498, 86.82936 49.82667, 85.54127 49.69…
2 Uzbekistan  Asia      (((55.96819 41.30864, 57.09639 41.32231, 56.93222 41.82…
3 Indonesia   Asia      (((104.37 -1.084843, 104.0108 -1.059212, 103.4376 -0.71…
4 Timor-Leste Asia      (((124.9687 -8.89279, 125.07 -9.089987, 125.0885 -9.393…
5 Israel      Asia      (((35.71992 32.70919, 35.7008 32.71601, 35.8364 32.8681…</code></pre>
</div>
</div>
<p>An alternative to piped operations is nested function calls, which are harder to read:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>world8 <span class="ot">=</span> <span class="fu">slice</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(world, continent <span class="sc">==</span> <span class="st">"Asia"</span>),</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    name_long, continent),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>world8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 34.26543 ymin: -10.35999 xmax: 141.0339 ymax: 55.38525
Geodetic CRS:  WGS 84
# A tibble: 5 × 3
  name_long   continent                                                     geom
  &lt;chr&gt;       &lt;chr&gt;                                           &lt;MULTIPOLYGON [°]&gt;
1 Kazakhstan  Asia      (((87.35997 49.21498, 86.82936 49.82667, 85.54127 49.69…
2 Uzbekistan  Asia      (((55.96819 41.30864, 57.09639 41.32231, 56.93222 41.82…
3 Indonesia   Asia      (((104.37 -1.084843, 104.0108 -1.059212, 103.4376 -0.71…
4 Timor-Leste Asia      (((124.9687 -8.89279, 125.07 -9.089987, 125.0885 -9.393…
5 Israel      Asia      (((35.71992 32.70919, 35.7008 32.71601, 35.8364 32.8681…</code></pre>
</div>
</div>
<p>Another alternative is to split the operations into multiple self-contained lines</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>world9_filtered <span class="ot">=</span> <span class="fu">filter</span>(world, continent <span class="sc">==</span> <span class="st">"Asia"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>world9_selected <span class="ot">=</span> <span class="fu">select</span>(world9_filtered, continent)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>world9 <span class="ot">=</span> <span class="fu">slice</span>(world9_selected, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vector-attribute-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="vector-attribute-aggregation"><strong>3.2.3 Vector attribute aggregation</strong></h3>
<p>Aggregation involves summarizing data with one or more ‘grouping variables’, typically from columns in the data frame to be aggregated</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>world_agg1 <span class="ot">=</span> <span class="fu">aggregate</span>(pop <span class="sc">~</span> continent, <span class="at">FUN =</span> sum, <span class="at">data =</span> world,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>world_agg1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      continent        pop
1        Africa 1154946633
2          Asia 4311408059
3        Europe  669036256
4 North America  565028684
5       Oceania   37757833
6 South America  412060811</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(world_agg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>The result is a non-spatial data frame with six rows, one per continent, and two columns reporting the name and population of each continent&nbsp;</p>
<p><a href="https://rspatial.github.io/terra/reference/aggregate.html"><code>aggregate()</code></a>&nbsp;is a&nbsp;<a href="https://adv-r.hadley.nz/s3.html#s3-methods">generic function</a>&nbsp;which means that it behaves differently depending on its inputs.&nbsp;<strong>sf</strong>&nbsp;provides the method&nbsp;<code>aggregate.sf()</code>&nbsp;which is activated automatically when&nbsp;<code>x</code>&nbsp;is an&nbsp;<code>sf</code>&nbsp;object and a&nbsp;<code>by</code>&nbsp;argument is provided:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>world_agg2 <span class="ot">=</span> <span class="fu">aggregate</span>(world[<span class="st">"pop"</span>], <span class="at">by =</span> <span class="fu">list</span>(world<span class="sc">$</span>continent), <span class="at">FUN =</span> sum, </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(world_agg2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(world_agg2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>world_agg2 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 8 features and 2 fields
Attribute-geometry relationships: aggregate (1), identity (1)
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
                  Group.1        pop                       geometry
1                  Africa 1154946633 MULTIPOLYGON (((-11.43878 6...
2              Antarctica          0 MULTIPOLYGON (((-61.13898 -...
3                    Asia 4311408059 MULTIPOLYGON (((48.67923 14...
4                  Europe  669036256 MULTIPOLYGON (((-53.55484 2...
5           North America  565028684 MULTIPOLYGON (((-155.2222 1...
6                 Oceania   37757833 MULTIPOLYGON (((147.9141 -4...
7 Seven seas (open ocean)          0 POLYGON ((68.935 -48.625, 6...
8           South America  412060811 MULTIPOLYGON (((-68.63999 -...</code></pre>
</div>
</div>
<p>The resulting <code>world_agg2</code> object is a spatial object containing 8 features representing the continents of the world (and the open ocean).</p>
<p><code>group_by() |&gt; summarize()</code> is the <strong>dplyr</strong> equivalent of <a href="https://rspatial.github.io/terra/reference/aggregate.html"><code>aggregate()</code></a>, with the variable name provided in the <a href="https://dplyr.tidyverse.org/reference/group_by.html"><code>group_by()</code></a> function specifying the grouping variable and information on what is to be summarized passed to the <a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>summarize()</code></a> function, as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>world_agg3 <span class="ot">=</span> world <span class="sc">|&gt;</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">|&gt;</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pop =</span> <span class="fu">sum</span>(pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>world_agg3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 8 features and 2 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 8 × 3
  continent                      pop                                        geom
  &lt;chr&gt;                        &lt;dbl&gt;                              &lt;GEOMETRY [°]&gt;
1 Africa                  1154946633 MULTIPOLYGON (((36.86623 22, 36.69069 22.2…
2 Antarctica                       0 MULTIPOLYGON (((-180 -89.9, 180 -89.9, 180…
3 Asia                    4311408059 MULTIPOLYGON (((36.14976 35.82153, 35.9050…
4 Europe                   669036256 MULTIPOLYGON (((26.29 35.29999, 25.74502 3…
5 North America            565028684 MULTIPOLYGON (((-82.26815 23.18861, -82.51…
6 Oceania                   37757833 MULTIPOLYGON (((166.7932 -15.66881, 167.00…
7 Seven seas (open ocean)          0 POLYGON ((68.935 -48.625, 68.8675 -48.83, …
8 South America            412060811 MULTIPOLYGON (((-66.95992 -54.89681, -66.4…</code></pre>
</div>
</div>
<p>The approach may seem more complex but it has benefits: flexibility, readability, and control over the new column names.&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>world_agg4  <span class="ot">=</span> world <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">|&gt;</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Pop =</span> <span class="fu">sum</span>(pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">Area =</span> <span class="fu">sum</span>(area_km2), <span class="at">N =</span> <span class="fu">n</span>())</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>world_agg4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 8 features and 4 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 8 × 5
  continent                      Pop      Area     N                        geom
  &lt;chr&gt;                        &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;              &lt;GEOMETRY [°]&gt;
1 Africa                  1154946633 29946198.    51 MULTIPOLYGON (((36.86623 2…
2 Antarctica                       0 12335956.     1 MULTIPOLYGON (((-180 -89.9…
3 Asia                    4311408059 31252459.    47 MULTIPOLYGON (((36.14976 3…
4 Europe                   669036256 23065219.    39 MULTIPOLYGON (((26.29 35.2…
5 North America            565028684 24484309.    18 MULTIPOLYGON (((-82.26815 …
6 Oceania                   37757833  8504489.     7 MULTIPOLYGON (((166.7932 -…
7 Seven seas (open ocean)          0    11603.     1 POLYGON ((68.935 -48.625, …
8 South America            412060811 17762592.    13 MULTIPOLYGON (((-66.95992 …</code></pre>
</div>
</div>
<p>Let’s combine what we have learned so far about&nbsp;<strong>dplyr</strong>&nbsp;functions, by chaining multiple commands to summarize attribute data about countries worldwide by continent.&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>world_agg5 <span class="ot">=</span> world <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span>                      <span class="co"># drop the geometry for speed</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pop, continent, area_km2) <span class="sc">|&gt;</span> <span class="co"># subset the columns of interest  </span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">|&gt;</span>                     <span class="co"># group by continent and summarize:</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Pop =</span> <span class="fu">sum</span>(pop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">Area =</span> <span class="fu">sum</span>(area_km2), <span class="at">N =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Density =</span> <span class="fu">round</span>(Pop <span class="sc">/</span> Area)) <span class="sc">|&gt;</span>     <span class="co"># calculate population density</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Pop, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span>                   <span class="co"># keep only the top 3</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(N))                           <span class="co"># arrange in order of n. countries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vector-attribute-joining" class="level3">
<h3 class="anchored" data-anchor-id="vector-attribute-joining"><strong>3.2.4 Vector attribute joining</strong></h3>
<p><strong>dplyr</strong>&nbsp;join functions work the same on data frames and&nbsp;<code>sf</code>&nbsp;objects, the only important difference being the&nbsp;<code>geometry</code>&nbsp;list column. The result of data joins can be either an&nbsp;<code>sf</code>&nbsp;or&nbsp;<code>data.frame</code>&nbsp;object. The most common type of attribute join on spatial data takes an&nbsp;<code>sf</code>&nbsp;object as the first argument and adds columns to it from a&nbsp;<code>data.frame</code>&nbsp;specified as the second argument.</p>
<p>To demonstrate joins, we will combine data on coffee production with the&nbsp;<code>world</code>&nbsp;dataset. The coffee data is in a data frame called&nbsp;<code>coffee_data</code>&nbsp;from the&nbsp;<strong>spData</strong>&nbsp;package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>world_coffee <span class="ot">=</span> <span class="fu">left_join</span>(world, coffee_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name_long)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(name_long)`</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>world_coffee</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 12 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 13
   iso_a2 name_long continent region_un subregion type  area_km2     pop lifeExp
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 FJ     Fiji      Oceania   Oceania   Melanesia Sove…   1.93e4  8.86e5    70.0
 2 TZ     Tanzania  Africa    Africa    Eastern … Sove…   9.33e5  5.22e7    64.2
 3 EH     Western … Africa    Africa    Northern… Inde…   9.63e4 NA         NA  
 4 CA     Canada    North Am… Americas  Northern… Sove…   1.00e7  3.55e7    82.0
 5 US     United S… North Am… Americas  Northern… Coun…   9.51e6  3.19e8    78.8
 6 KZ     Kazakhst… Asia      Asia      Central … Sove…   2.73e6  1.73e7    71.6
 7 UZ     Uzbekist… Asia      Asia      Central … Sove…   4.61e5  3.08e7    71.0
 8 PG     Papua Ne… Oceania   Oceania   Melanesia Sove…   4.65e5  7.76e6    65.2
 9 ID     Indonesia Asia      Asia      South-Ea… Sove…   1.82e6  2.55e8    68.9
10 AR     Argentina South Am… Americas  South Am… Sove…   2.78e6  4.30e7    76.3
# ℹ 167 more rows
# ℹ 4 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;,
#   coffee_production_2016 &lt;int&gt;, coffee_production_2017 &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(world_coffee)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Because the input datasets share a ‘key variable’ (<code>name_long</code>) the join worked without using the&nbsp;<code>by</code>&nbsp;argument (see&nbsp;<a href="https://dplyr.tidyverse.org/reference/mutate-joins.html"><code>?left_join</code></a>&nbsp;for details). The result is an&nbsp;<code>sf</code>&nbsp;object identical to the original&nbsp;<code>world</code>&nbsp;object but with two new variables (with column indices 11 and 12) on coffee production.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(world_coffee)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "iso_a2"                 "name_long"              "continent"             
 [4] "region_un"              "subregion"              "type"                  
 [7] "area_km2"               "pop"                    "lifeExp"               
[10] "gdpPercap"              "geom"                   "coffee_production_2016"
[13] "coffee_production_2017"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world_coffee[<span class="st">"coffee_production_2017"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3.-Attribute-data-operations_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the majority of cases where variable names are not the same, you have two options:</p>
<ol type="1">
<li><p>Rename the key variable in one of the objects so they match.</p></li>
<li><p>Use the <code>by</code> argument to specify the joining variables.</p></li>
</ol>
<p>The latter approach is demonstrated below on a renamed version of <code>coffee_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>coffee_renamed <span class="ot">=</span> <span class="fu">rename</span>(coffee_data, <span class="at">nm =</span> name_long)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>world_coffee2 <span class="ot">=</span> <span class="fu">left_join</span>(world, coffee_renamed, <span class="at">by =</span> <span class="fu">join_by</span>(name_long <span class="sc">==</span> nm))</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>world_coffee2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 12 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
# A tibble: 177 × 13
   iso_a2 name_long continent region_un subregion type  area_km2     pop lifeExp
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 FJ     Fiji      Oceania   Oceania   Melanesia Sove…   1.93e4  8.86e5    70.0
 2 TZ     Tanzania  Africa    Africa    Eastern … Sove…   9.33e5  5.22e7    64.2
 3 EH     Western … Africa    Africa    Northern… Inde…   9.63e4 NA         NA  
 4 CA     Canada    North Am… Americas  Northern… Sove…   1.00e7  3.55e7    82.0
 5 US     United S… North Am… Americas  Northern… Coun…   9.51e6  3.19e8    78.8
 6 KZ     Kazakhst… Asia      Asia      Central … Sove…   2.73e6  1.73e7    71.6
 7 UZ     Uzbekist… Asia      Asia      Central … Sove…   4.61e5  3.08e7    71.0
 8 PG     Papua Ne… Oceania   Oceania   Melanesia Sove…   4.65e5  7.76e6    65.2
 9 ID     Indonesia Asia      Asia      South-Ea… Sove…   1.82e6  2.55e8    68.9
10 AR     Argentina South Am… Americas  South Am… Sove…   2.78e6  4.30e7    76.3
# ℹ 167 more rows
# ℹ 4 more variables: gdpPercap &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;,
#   coffee_production_2016 &lt;int&gt;, coffee_production_2017 &lt;int&gt;</code></pre>
</div>
</div>
<p>Note that the name in the original object is kept, meaning that&nbsp;<code>world_coffee</code>&nbsp;and the new object&nbsp;<code>world_coffee2</code>&nbsp;are identical. Another feature of the result is that it has the same number of rows as the original dataset. Although there are only 47 rows of data in&nbsp;<code>coffee_data</code>, all 177 country records are kept intact in&nbsp;<code>world_coffee</code>&nbsp;and&nbsp;<code>world_coffee2</code>: rows in the original dataset with no match are assigned&nbsp;<code>NA</code>&nbsp;values for the new coffee production variables. What if we only want to keep countries that have a match in the key variable? In that case an inner join can be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>world_coffee_inner <span class="ot">=</span> <span class="fu">inner_join</span>(world, coffee_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name_long)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(name_long)`</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(world_coffee_inner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45</code></pre>
</div>
</div>
<p>Note that the result of&nbsp;<a href="https://dplyr.tidyverse.org/reference/mutate-joins.html"><code>inner_join()</code></a>&nbsp;has only 45 rows compared with 47 in&nbsp;<code>coffee_data</code>. What happened to the remaining rows? We can identify the rows that did not match using the&nbsp;<a href="https://generics.r-lib.org/reference/setops.html"><code>setdiff()</code></a>&nbsp;function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(coffee_data<span class="sc">$</span>name_long, world<span class="sc">$</span>name_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Congo, Dem. Rep. of" "Others"             </code></pre>
</div>
</div>
<p>The result shows that&nbsp;<code>Others</code>&nbsp;accounts for one row not present in the&nbsp;<code>world</code>&nbsp;dataset and that the name of the&nbsp;<code>Democratic Republic of the Congo</code>&nbsp;accounts for the other: it has been abbreviated, causing the join to miss it. The following command uses a string matching (<em>regex</em>) function from the&nbsp;<strong>stringr</strong>&nbsp;package to confirm what&nbsp;<code>Congo, Dem. Rep. of</code>&nbsp;should be.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>drc <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(world<span class="sc">$</span>name_long, <span class="st">"Dem*.+Congo"</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>drc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Democratic Republic of the Congo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Democratic Republic of the Congo"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To fix this issue, we will create a new version of&nbsp;<code>coffee_data</code>&nbsp;and update the name.&nbsp;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>coffee_data<span class="sc">$</span>name_long[<span class="fu">grepl</span>(<span class="st">"Congo,"</span>, coffee_data<span class="sc">$</span>name_long)] <span class="ot">=</span> drc</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>world_coffee_match <span class="ot">=</span> <span class="fu">inner_join</span>(world, coffee_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name_long)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(name_long)`</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(world_coffee_match)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 46</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>